<?xml version="1.0" ?>

<project name="repec.ras" default="build.example">

  <!-- include contrib file (placed in lib dir)  -->
  <taskdef resource="net/sf/antcontrib/antlib.xml" />

  <!-- source dirs -->
  <property name="rdf.dir" location="../var/ras/latest/rdf" />
  <property name="jsonld.file" location="${rdf.dir}/ras.jsonld" />
  <property name="turtle.file" location="${rdf.dir}/ras.ttl" />
  <property name="example.jsonld.file" location="../var/pers_examples/example1/rdf/example1.jsonld" />
  <property name="example.turtle.file" location="../var/pers_examples/example1/rdf/example1.ttl" />


  <!-- ######################### -->
  <target name="build.rdf">

    <antcall target="timestamp2">
      <param name="message" value="Build jsonld file" />
    </antcall>
    <exec executable="perl" output="${jsonld.file}" failonerror="true" logerror="true">
      <arg value="ras2jsonld.pl" />
      <arg value="../var/ras/latest/src/per" />
    </exec>
    <antcall target="timestamp2">
      <param name="message" value="Generate ttl and ntriples files" />
    </antcall>
    <exec executable="riot" output="${turtle.file}" failonerror="true" logerror="true">
      <arg value="--strict" />
      <arg value="--check" />
      <arg value="--formatted=turtle" />
      <arg value="${jsonld.file}" />
    </exec>
    <exec executable="riot" output="${rdf.dir}/ras.nt" failonerror="true" logerror="true">
      <arg value="--strict" />
      <arg value="--check" />
      <arg value="${turtle.file}" />
    </exec>

  </target>


  <!-- ######################### -->
  <target name="build.example">

    <exec executable="perl" output="${example.jsonld.file}" failonerror="true" logerror="true">
      <arg value="ras2jsonld.pl" />
      <arg value="../var/pers_examples/example1/src" />
    </exec>
    <echo message="Generated ${example.jsonld.file}" />
    <exec executable="riot" output="${example.turtle.file}" failonerror="true" logerror="true">
      <arg value="--strict" />
      <arg value="--check" />
      <arg value="--formatted=turtle" />
      <arg value="${example.jsonld.file}" />
    </exec>
    <echo message="Generated ${example.turtle.file}" />

  </target>


  <!-- ######################### -->
  <target name="get.dbpedia">

    <exec executable="sh" failonerror="true" logerror="true">
      <arg line="-c './get_dbpedia.sh'" />
    </exec>

  </target>


  <!-- ######################### -->
  <target name="extract.dbpedia.repecid">

    <exec executable="perl" output="../var/ras/latest/rdf/dbpedia_repecid.ttl" failonerror="true" logerror="true">
      <arg value="extract_dbpedia_repecid.pl" />
      <arg value="../var/dbpedia/latest/rdf/infobox_properties_mapped_en.ttl" />
    </exec>

  </target>


  <!-- ######################### -->
  <target name="load.dbpedia">

    <exec executable="sh" failonerror="true" logerror="false">
      <arg line="-c './load_suppl.sh dbpedia ../var/dbpedia/latest/rdf/dbpedia_repecid.ttl ../var/dbpedia/latest/rdf/wikidata_links_en.ttl'" />
    </exec>

  </target>


  <!-- ######################### -->
  <target name="timestamp2">
    <tstamp>
      <format property="current.time" pattern="yyyy-MM-dd hh:mm:ss aa" />
    </tstamp>

    <echo message="${message} ${current.time}" />      
  </target>

</project>

