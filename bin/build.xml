<?xml version="1.0" ?>

<project name="repec.ras" default="build.example">

  <!-- include contrib file (placed in lib dir)  -->
  <taskdef resource="net/sf/antcontrib/antlib.xml" />

  <!-- source dirs -->
  <property name="rdf.dir" location="../var/ras/latest/rdf" />
  <property name="jsonld.file" location="${rdf.dir}/ras.jsonld" />
  <property name="turtle.file" location="${rdf.dir}/ras.ttl" />
  <property name="example.ras.jsonld.file" location="../var/ras/example1/rdf/example1.jsonld" />
  <property name="example.ras.turtle.file" location="../var/ras/example1/rdf/example1.ttl" />


  <!-- ######################### -->
  <target name="build.rdf">

    <antcall target="timestamp2">
      <param name="message" value="Build jsonld file" />
    </antcall>
    <exec executable="perl" output="${jsonld.file}" failonerror="true" logerror="true">
      <arg value="redif2jsonld.pl" />
      <arg value="ras" />
      <arg value="../var/ras/latest/src/per" />
    </exec>
    <antcall target="timestamp2">
      <param name="message" value="Generate ttl and ntriples files" />
    </antcall>
    <exec executable="riot" output="${turtle.file}" failonerror="true" logerror="true">
      <arg value="--strict" />
      <arg value="--check" />
      <arg value="--formatted=turtle" />
      <arg value="${jsonld.file}" />
    </exec>
    <exec executable="riot" output="${rdf.dir}/ras.nt" failonerror="true" logerror="true">
      <arg value="--strict" />
      <arg value="--check" />
      <arg value="${turtle.file}" />
    </exec>

  </target>


  <!-- ######################### -->
  <target name="build.example.ras">

    <exec executable="perl" output="${example.ras.jsonld.file}" failonerror="true" logerror="true">
      <arg value="redif2jsonld.pl" />
      <arg value="ras" />
      <arg value="../var/ras/example1/src" />
    </exec>
    <echo message="Generated ${example.ras.jsonld.file}" />
    <exec executable="riot" output="${example.ras.turtle.file}" failonerror="true" logerror="true">
      <arg value="--strict" />
      <arg value="--check" />
      <arg value="--formatted=turtle" />
      <arg value="${example.ras.jsonld.file}" />
    </exec>
    <echo message="Generated ${example.ras.turtle.file}" />

  </target>


  <!-- ######################### -->
  <target name="beacon.mapping">

    <exec executable="perl" output="../var/ras/example2/map/gnd_ras_mapping.example.txt" failonerror="true" logerror="false">
      <arg value="create_mapping_beacon.pl" />
    </exec>

  </target>


  <!-- ######################### -->
  <target name="get.ranks">

    <exec executable="perl" failonerror="true" logerror="true">
      <arg line="./extract_ras_ranks.pl" />
    </exec>

  </target>


  <!-- ######################### -->
  <target name="load.ranks">

    <foreach list="rasRankTop10pct-november2016,rasRankTop10pctFemale-november2016" target="load.rank" param="ranking" />

  </target>

  <target name="load.rank">

    <exec executable="sh" failonerror="true" logerror="false">
      <arg line="-c './load_suppl.sh ${ranking} ../var/ras/latest/rdf/${ranking}.nt'" />
    </exec>

  </target>


  <!-- ######################### -->
  <target name="get.dbpedia">

    <exec executable="sh" failonerror="true" logerror="true">
      <arg line="-c './get_dbpedia.sh'" />
    </exec>

  </target>


  <!-- ######################### -->
  <target name="load.dbpedia">

    <exec executable="sh" failonerror="true" logerror="false">
      <arg line="-c './load_suppl.sh dbpedia ../var/ras/latest/rdf/dbpedia_repecid.ttl ../var/ras/latest/rdf/dbpedia_wikidata_links.ttl'" />
    </exec>

  </target>


  <!-- ######################### -->
  <target name="beacon.dbpedia">

    <exec executable="perl" output="../var/ras/latest/beacon/dbpedia_repec_wd.txt" failonerror="true" logerror="false">
      <arg value="create_dbpedia_beacon.pl" />
    </exec>

  </target>


  <!-- ######################### -->
  <target name="timestamp2">
    <tstamp>
      <format property="current.time" pattern="yyyy-MM-dd hh:mm:ss aa" />
    </tstamp>

    <echo message="${message} ${current.time}" />      
  </target>

</project>

